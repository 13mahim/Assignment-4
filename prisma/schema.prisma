generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String          @id @default(cuid())
  email             String          @unique
  password          String
  name              String
  role              Role            @default(STUDENT)
  isActive          Boolean         @default(true)
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt

  studentProfile    StudentProfile?
  tutorProfile      TutorProfile?

  bookingsAsStudent Booking[]       @relation("StudentBookings")
  bookingsAsTutor   Booking[]       @relation("TutorBookings")

  reviewsWritten    Review[]        @relation("Reviewer")
  reviewsReceived   Review[]        @relation("TutorReview")

  @@map("users")
}

model StudentProfile {
  id        String   @id @default(cuid())
  userId    String   @unique
  phone     String?
  bio       String?
  subjects  String[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("student_profiles")
}

model TutorProfile {
  id           String         @id @default(cuid())
  userId       String         @unique
  title        String
  bio          String
  hourlyRate   Float
  phone        String
  education    String
  experience   Int
  subjects     String[]

  availability Availability[]
  bookings     Booking[]      @relation("TutorProfileBookings")

  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt

  user         User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("tutor_profiles")
}

model Availability {
  id          String       @id @default(cuid())
  tutorId     String
  dayOfWeek   Int
  startTime   String
  endTime     String
  isAvailable Boolean      @default(true)

  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  tutor       TutorProfile @relation(fields: [tutorId], references: [id], onDelete: Cascade)

  @@unique([tutorId, dayOfWeek, startTime])
  @@map("availabilities")
}

model Category {
  id          String   @id @default(cuid())
  name        String   @unique
  description String?
  icon        String?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("categories")
}

model Booking {
  id             String        @id @default(cuid())
  studentId      String
  tutorId        String
  tutorProfileId String

  date           DateTime
  startTime      String
  endTime        String

  subject        String
  notes          String?
  totalAmount    Float

  status         BookingStatus @default(PENDING)

  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  student        User          @relation("StudentBookings", fields: [studentId], references: [id])
  tutor          User          @relation("TutorBookings", fields: [tutorId], references: [id])
  tutorProfile   TutorProfile  @relation("TutorProfileBookings", fields: [tutorProfileId], references: [id])

  review         Review?

  @@map("bookings")
}

model Review {
  id         String   @id @default(cuid())
  bookingId  String   @unique
  reviewerId String
  tutorId    String

  rating     Int
  comment    String?

  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  booking    Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  reviewer   User     @relation("Reviewer", fields: [reviewerId], references: [id])
  tutor      User     @relation("TutorReview", fields: [tutorId], references: [id])

  @@map("reviews")
}

enum Role {
  STUDENT
  TUTOR
  ADMIN
}

enum BookingStatus {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELLED
}