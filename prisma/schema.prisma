datasource db {
  provider = "postgresql"
  //  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum Role {
  STUDENT
  TUTOR
  ADMIN
}

enum BookingStatus {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELLED
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String
  role      Role     @default(STUDENT)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  studentProfile    StudentProfile?
  tutorProfile      TutorProfile?
  bookingsAsStudent Booking[]       @relation("StudentBookings")
  bookingsAsTutor   Booking[]       @relation("TutorBookings")
  reviewsWritten    Review[]        @relation("Reviewer")
  reviewsReceived   Review[]        @relation("TutorReview")

  @@map("users")
}

model StudentProfile {
  id        String   @id @default(cuid())
  userId    String   @unique
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  phone     String?
  bio       String?
  subjects  String[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("student_profiles")
}

model TutorProfile {
  id         String   @id @default(cuid())
  userId     String   @unique
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  title      String
  bio        String
  hourlyRate Float
  phone      String
  education  String
  experience Int
  subjects   String[]
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  availability Availability[]
  bookings     Booking[]      @relation("TutorProfileBookings")

  @@map("tutor_profiles")
}

model Availability {
  id          String       @id @default(cuid())
  tutorId     String
  tutor       TutorProfile @relation(fields: [tutorId], references: [id], onDelete: Cascade)
  dayOfWeek   Int
  startTime   String
  endTime     String
  isAvailable Boolean      @default(true)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  @@unique([tutorId, dayOfWeek, startTime])
  @@map("availabilities")
}

model Category {
  id          String   @id @default(cuid())
  name        String   @unique
  description String?
  icon        String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("categories")
}

model Booking {
  id             String @id @default(cuid())
  studentId      String
  tutorId        String
  tutorProfileId String

  student      User         @relation("StudentBookings", fields: [studentId], references: [id])
  tutor        User         @relation("TutorBookings", fields: [tutorId], references: [id])
  tutorProfile TutorProfile @relation("TutorProfileBookings", fields: [tutorProfileId], references: [id])

  date        DateTime
  startTime   String
  endTime     String
  status      BookingStatus @default(PENDING)
  subject     String
  notes       String?
  totalAmount Float
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  review Review?

  @@map("bookings")
}

model Review {
  id         String   @id @default(cuid())
  bookingId  String   @unique
  booking    Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  reviewerId String
  reviewer   User     @relation("Reviewer", fields: [reviewerId], references: [id])
  tutorId    String
  tutor      User     @relation("TutorReview", fields: [tutorId], references: [id])
  rating     Int
  comment    String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("reviews")
}
